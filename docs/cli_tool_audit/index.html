<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>cli_tool_audit API documentation</title>
<meta name="description" content="Audit CLI tool version numbers …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>cli_tool_audit</code></h1>
</header>
<section id="section-intro">
<p>Audit CLI tool version numbers.</p>
<h1 id="cli_tool_audit">cli_tool_audit</h1>
<p>Verify that a list of cli tools are available. Like a requirements.txt for cli tools, but without an installer
component. Intended to work with cli tools regardless to how they were installed, e.g. via pipx, npm, etc.</p>
<p>If 100% of your tools are installed by the same package manager that can install tools from a list with desired
versions, then you don't need this tool.</p>
<p>Some useful scenarios:</p>
<ul>
<li>Validating a developer's workstation instead of an "install everything" script.</li>
<li>
<ul>
<li>Validating a CI environment and failing the build when configuration has drifted</li>
</ul>
</li>
<li>Validating an end user's environment before running an app where you can't install all the
dependencies for them.</li>
</ul>
<h2 id="how-it-works">How it works</h2>
<p>You declare a list of cli commands and version ranges.</p>
<p>The tool will run <code>tool --version</code> for each tool and make best efforts to parse the result and compare it to the
desired version range.</p>
<p>The tool then can either output a report with warnings or signal failure if something is missing, the wrong version
or can't be determined.</p>
<p>There is no universal method for getting a version number from a CLI tool, nor is there a universal orderable
version number system, so the outcome of many check may be limited to an existence check or exact version number check.</p>
<p>Here is an example run.</p>
<pre><code class="language-text">❯ cli_tool_audit audit
+--------+--------------------------+--------+----------+------------+----------+
|  Tool  |          Found           | Parsed | Desired  |   Status   | Modified |
+--------+--------------------------+--------+----------+------------+----------+
|  java  | openjdk version &quot;17.0.6&quot; | 17.0.6 | &gt;=17.0.6 | Compatible | 01/18/23 |
|  make  |      GNU Make 3.81       | 3.81.0 |  &gt;=3.81  | Compatible | 11/24/06 |
|        |       Copyright (        |        |          |            |          |
| python |      Python 3.11.1       | 3.11.1 | &gt;=3.11.1 | Compatible | 01/13/24 |
+--------+--------------------------+--------+----------+------------+----------+
</code></pre>
<h2 id="installation">Installation</h2>
<p>You will need to install it to your virtual environment if tools you are looking for are in your virtual environment.
If all the tools are global then you can pipx install. It is on the roadmap to support a pipx install for all scenarios.</p>
<pre><code class="language-shell">pipx install cli-tool-audit
</code></pre>
<h2 id="usage">Usage</h2>
<p>Generate minimal config for a few tools.</p>
<pre><code class="language-bash">cli_tool_audit freeze python java make rustc
</code></pre>
<p>Copy result of above into your pyproject.toml. Edit as needed, especially if you don't want snapshot versioning,
which is probably too strict.</p>
<p>Audit the environment with the current configuration.</p>
<pre><code class="language-bash">cli_tool_audit audit
</code></pre>
<p>All commands</p>
<pre><code class="language-text">❯ cli_tool_audit --help
usage: cli_tool_audit [-h] [-V] [--verbose] [--demo {pipx,venv,npm}]
                      {interactive,freeze,audit,single,read,create,update,delete} ...

Audit for existence and version number of cli tools.

positional arguments:
  {interactive,freeze,audit,single,read,create,update,delete}
                        Subcommands.
    interactive         Interactively edit configuration
    freeze              Freeze the versions of specified tools
    audit               Audit environment with current configuration
    single              Audit one tool without configuration file
    read                Read and list all tool configurations
    create              Create a new tool configuration
    update              Update an existing tool configuration
    delete              Delete a tool configuration

options:
  -h, --help            show this help message and exit
  -V, --version         Show program's version number and exit.
  --verbose             verbose output
  --demo {pipx,venv,npm}
                        Demo for values of npm, pipx or venv

    Examples:

        # Audit and report using pyproject.toml
        cli_tool_audit audit

        # Generate config for snapshots
        cli_tool_audit freeze python java make rustc
</code></pre>
<p>Note. If you use the create/update commands and specify the <code>--version</code> switch, it must have an equal sign.</p>
<p>Here is how to generate a freeze, a list of current versions by snapshot, for a lis tof tools. All tools will be
check with <code>--version</code> unless they are well known.</p>
<pre><code class="language-shell">cli_tool_audit freeze python java make rustc
</code></pre>
<p>This is for programmatic usage.</p>
<pre><code class="language-python">import cli_tool_audit

print(cli_tool_audit.validate(file_path=&quot;pyproject.toml&quot;))
</code></pre>
<p>The configuration file lists the tools you expect how hints on how detect the version.</p>
<pre><code class="language-toml">[tool.cli-tools]
# Typical example
pipx = { version = &quot;&gt;=1.0.0&quot;, version_switch = &quot;--version&quot; }
# Restrict to specific OS
brew = { version = &quot;&gt;=0.1.0&quot;, if_os=&quot;darwin&quot; }
# Pin to a snapshot of the output of `poetry --version`
poetry = {version = &quot;Poetry (version 1.5.1)&quot;, schema=&quot;snapshot&quot;}
# Don't attempt to run `notepad --version`, just check if it is on the path
notepad = { schema = &quot;existence&quot; }
# Any version.
vulture = { version = &quot;*&quot; }
# Supports ^ and ~ version ranges.
shellcheck = { version = &quot;^0.8.0&quot; }
# Uses semver's compatibility logic, which is not the same as an exact match.
rustc = { version = &quot;1.67.0&quot; }
</code></pre>
<p>See <a href="https://python-semver.readthedocs.io/en/latest/usage/check-compatible-semver-version.html">semver3</a> for
compatibility logic for versions without operators/symbols.</p>
<p>See <a href="https://python-poetry.org/docs/dependency-specification/">poetry</a> for version range specifiers.</p>
<p>See <a href="https://stackoverflow.com/a/13874620/33264">stackoverflow</a> for os names.</p>
<h2 id="demos">Demos</h2>
<p>Demos will discover a bunch of executables as installed in the local virtual environment, installed by pipx or
installed by npm. It will then assume that we want the current or any version and run an audit. Since we know these
files already exist, the failures are centered on failing to execute, failing to guess the version switch, failure
to parse the switch or the
tool's version switch returning a version incompatible to what the package manager reports.</p>
<pre><code class="language-bash">cli_tool_audit --demo=pipx --verbose
cli_tool_audit --demo=venv --verbose
cli_tool_audit --demo=npm --verbose
</code></pre>
<h2 id="how-does-this-relate-to-package-managers-eg-apt-pipx-npm-choco-etc">How does this relate to package managers, e.g. apt, pipx, npm, choco, etc.</h2>
<p>Package managers do far more than check for the existence of a tool. They will install it, at the desired version
and make sure that tools and their transitive dependencies are compatible.</p>
<p>What they can't do is verify what other package managers have done.</p>
<p>This captures your desired tools, versions and guarantees you have them by installing them.</p>
<pre><code class="language-shell"># list everything available on one machine
pip freeze&gt;requirements.txt
# install it on another.
pip install -r requirements.txt
</code></pre>
<p>This is the same thing, but for windows and .net centric apps.</p>
<pre><code class="language-shell">choco export requirements.txt
choco install -y requirements.txt
</code></pre>
<p>There are similar patterns, for apt, brew, npm, and so on.</p>
<p>It would be foolish to try to create a package manager that supports other package managers, so features in that
vein are out of scope.</p>
<h2 id="prior-art">Prior Art</h2>
<ul>
<li><a href="https://github.com/jstutters/toolaudit">tool-audit</a></li>
<li><a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet-tool-list">dotnet-tool-list</a></li>
</ul>
<h1 id="use-cases">Use Cases</h1>
<h2 id="developer-environment">Developer Environment</h2>
<p>Goal: Make sure developers have all the tools they need at a suitable version.</p>
<p>Alternative solutions: Docker files, imaged laptops, devcontainers, installing all tools with the same package manager.</p>
<h3 id="steps">Steps</h3>
<ol>
<li>Freeze the versions of the tools you want to use. Developers may have different OS, and getting workstations
exactly the same is difficult, so choose "semver" for some flexibility.</li>
</ol>
<pre><code class="language-shell">cli_tool_audit freeze python java make rustc --version semver
</code></pre>
<ol>
<li>Copy the output into your pyproject.toml.</li>
<li>Edit the "installation_instructions" as needed</li>
<li>Developers run on their machines, or as a early step in the local build process</li>
</ol>
<pre><code class="language-shell">cli_tool_audit audit
</code></pre>
<h2 id="serverbuild-server-configuration-drift-detection">Server/Build Server Configuration Drift Detection</h2>
<p>Goal: Know when the tool versions have drifted too far for comfort on the build server.</p>
<p>Alternative solutions: Docker base image that you control and upgrade on your own timeline.</p>
<ol>
<li>Freeze the versions of the tools you want to use.</li>
</ol>
<pre><code class="language-shell">cli_tool_audit freeze python java make rustc --version snapshot
</code></pre>
<ol>
<li>Copy the output into your pyproject.toml.</li>
<li>Add to build script.</li>
</ol>
<pre><code class="language-shell">cli_tool_audit audit
</code></pre>
<h2 id="end-user-application-pre-flight-checks">End-User Application "pre-flight" checks</h2>
<p>Goal: Make sure the user has the tools they need to run your application.</p>
<p>Alternative solutions: Bundle the other applications wiht your application.</p>
<h2 id="steps_1">Steps</h2>
<ol>
<li>Freeze the versions of the tools you want to use.</li>
</ol>
<pre><code class="language-shell">cli_tool_audit freeze python java make rustc --version snapshot
</code></pre>
<ol>
<li>Copy the output into your pyproject.toml or other toml file.</li>
<li>Call programmatically on startup.</li>
</ol>
<pre><code class="language-python">import cli_tool_audit

results = cli_tool_audit.validate(file_path=&quot;path/to/your/config.toml&quot;)
# Display results if there are problems.
</code></pre>
<h1 id="environment-variables">Environment Variables</h1>
<p>You can modify the apps behavior with environment variables.</p>
<h2 id="no_color"><code>NO_COLOR</code></h2>
<p>Disables progress bar, colored tables and color logging.</p>
<h2 id="ci"><code>CI</code></h2>
<p>Same as NO_COLOR</p>
<h2 id="cli_tool_audit_timeout"><code>CLI_TOOL_AUDIT_TIMEOUT</code></h2>
<p>This is how long a the application will wait for a tool to reply to a version query, defaults to 15 seconds.</p>
<h1 id="changelog">Changelog</h1>
<p>All notable changes to this project will be documented in this file.</p>
<p>The format is based on <a href="https://keepachangelog.com/en/1.0.0/">Keep a Changelog</a>,
and this project adheres to <a href="https://semver.org/spec/v2.0.0.html">Semantic Versioning</a>.</p>
<h2 id="300-2024-01-19">[3.0.0] - 2024-01-19</h2>
<h3 id="fixed">Fixed</h3>
<ul>
<li>only truncate long version on console output</li>
<li>removed three dependencies (toml, hypothesis, importlib-metadata)</li>
</ul>
<h3 id="added">Added</h3>
<ul>
<li>filter an audit by tags</li>
<li>install_docs, install_command to show what to do when there are problems</li>
<li><code>single</code> to validate one tool without a config file</li>
<li><code>.html</code> output</li>
</ul>
<h2 id="200-2024-01-19">[2.0.0] - 2024-01-19</h2>
<h3 id="fixed_1">Fixed</h3>
<ul>
<li>Cache now adds gitingore and clears files older than 30 days on startup</li>
<li>Audit is now a sub command with arguments.</li>
</ul>
<h3 id="changed">Changed</h3>
<ul>
<li>Gnu options with dashes, no underscores </li>
<li>Global opts that apply to only some commands move to subparser</li>
<li>check_only_for_existence is now schema type "existence" snapshot_version is now schema type "snapshot"</li>
<li>default action is now "audit" with all defaults.</li>
</ul>
<h2 id="120-2024-01-17">[1.2.0] - 2024-01-17</h2>
<h3 id="added_1">Added</h3>
<ul>
<li>Caching of good results, speeding things up</li>
<li>Caching enabled only for batches of 5+ tool checks</li>
<li>TODO: command to clear cache/change cache location</li>
<li>Formalize support of four schemas, semver, pep440, snapshot and exists.</li>
<li>Added <code>about.py</code></li>
</ul>
<h3 id="fixed_2">Fixed</h3>
<ul>
<li>"wrong OS" no longer flagged as problem</li>
<li>Added lock to ThreadPoolExecutor's work items</li>
</ul>
<h2 id="110-2024-01-16">[1.1.0] - 2024-01-16</h2>
<h3 id="added_2">Added</h3>
<ul>
<li>Interactive config at cli with <code>--interactive</code></li>
<li>Short switches for cli args and aliases for - and _ as connectors</li>
<li>Export multiple file formats with <code>--file-format</code></li>
<li>Added subcommand for <code>audit</code> with intention of removing default action.</li>
</ul>
<h3 id="fixed_3">Fixed</h3>
<ul>
<li>Spelling and docs. Make file now lints docs and runs spell check tools.</li>
</ul>
<h2 id="107-2024-01-16">[1.0.7] - 2024-01-16</h2>
<h3 id="fixed_4">Fixed</h3>
<ul>
<li>Spelling and docs. Make file now lints docs and runs spell check tools.</li>
</ul>
<h2 id="106-2024-01-15">[1.0.6] - 2024-01-15</h2>
<h3 id="fixed_5">Fixed</h3>
<ul>
<li>Add "basic_test.sh" and fix issue found with it.</li>
</ul>
<h2 id="105-2024-01-15">[1.0.5] - 2024-01-15</h2>
<h3 id="fixed_6">Fixed</h3>
<ul>
<li>Needs packaging lib in deps</li>
</ul>
<h2 id="104-2024-01-14">[1.0.4] - 2024-01-14</h2>
<h3 id="added_3">Added</h3>
<ul>
<li>Support for if_os, snapshot</li>
<li>Config manager and possibility to do config via cli</li>
<li>Freeze command</li>
<li>Last modified</li>
</ul>
<h3 id="fixed_7">Fixed</h3>
<ul>
<li>Tested with tox and got passing on 3.9-3.12</li>
<li>Possibly fixed dependencies.</li>
</ul>
<h2 id="103-2024-01-14">[1.0.3] - 2024-01-14</h2>
<h3 id="added_4">Added</h3>
<ul>
<li>Support for ^, ~ and * version ranges.</li>
</ul>
<h2 id="102-2024-01-14">[1.0.2] - 2024-01-14</h2>
<h3 id="added_5">Added</h3>
<ul>
<li>Color mode actually works now, problems are in red.</li>
<li>Logging and verbose switch created</li>
</ul>
<h3 id="fixed_8">Fixed</h3>
<ul>
<li>When calling subprocess, it now checks stderr if nothing returned by stdout</li>
</ul>
<h2 id="101-2024-01-13">[1.0.1] - 2024-01-13</h2>
<h3 id="added_6">Added</h3>
<ul>
<li>New stress test using npm.</li>
<li>Started concept of "known switches"</li>
</ul>
<h3 id="fixed_9">Fixed</h3>
<ul>
<li>All reports print with pretty tables</li>
<li>Version switch always defaults to <code>--version</code></li>
<li>Tuple results are now dataclasses</li>
<li>validate is now a function and exported</li>
</ul>
<h2 id="100-2024-01-13">[1.0.0] - 2024-01-13</h2>
<h3 id="added_7">Added</h3>
<ul>
<li>Application created.</li>
</ul>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
Audit CLI tool version numbers.

.. include:: ../README.md

.. include:: ../docs/UseCases.md

.. include:: ../docs/EnvironmentVariables.md

.. include:: ../CHANGELOG.md
&#34;&#34;&#34;
__all__ = [&#34;validate&#34;, &#34;process_tools&#34;, &#34;read_config&#34;, &#34;check_tool_availability&#34;, &#34;models&#34;, &#34;__version__&#34;, &#34;__about__&#34;]

import cli_tool_audit.__about__ as __about__
import cli_tool_audit.models as models
from cli_tool_audit.__about__ import __version__
from cli_tool_audit.call_tools import check_tool_availability
from cli_tool_audit.config_reader import read_config
from cli_tool_audit.views import process_tools, validate</code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="cli_tool_audit.audit_cache" href="audit_cache.html">cli_tool_audit.audit_cache</a></code></dt>
<dd>
<div class="desc"><p>This module provides a facade for the audit manager that caches results.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.audit_manager" href="audit_manager.html">cli_tool_audit.audit_manager</a></code></dt>
<dd>
<div class="desc"><p>Class to audit a tool, abstract base class to allow for supporting different version schemas …</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.call_and_compatible" href="call_and_compatible.html">cli_tool_audit.call_and_compatible</a></code></dt>
<dd>
<div class="desc"><p>Merge tool call and compatibility check results.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.call_tools" href="call_tools.html">cli_tool_audit.call_tools</a></code></dt>
<dd>
<div class="desc"><p>Check if an external tool is expected and available on the PATH …</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.compatibility" href="compatibility.html">cli_tool_audit.compatibility</a></code></dt>
<dd>
<div class="desc"><p>Functions for checking compatibility between versions.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.compatibility_complex" href="compatibility_complex.html">cli_tool_audit.compatibility_complex</a></code></dt>
<dd>
<div class="desc"><p>This module contains functions to check if a found version is compatible with a desired version range.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.config_manager" href="config_manager.html">cli_tool_audit.config_manager</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.config_reader" href="config_reader.html">cli_tool_audit.config_reader</a></code></dt>
<dd>
<div class="desc"><p>Read list of tools from config.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.freeze" href="freeze.html">cli_tool_audit.freeze</a></code></dt>
<dd>
<div class="desc"><p>Capture current version of a list of tools.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.interactive" href="interactive.html">cli_tool_audit.interactive</a></code></dt>
<dd>
<div class="desc"><p>Interactively manage tool configurations.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.json_utils" href="json_utils.html">cli_tool_audit.json_utils</a></code></dt>
<dd>
<div class="desc"><p>JSON utility functions.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.known_switches" href="known_switches.html">cli_tool_audit.known_switches</a></code></dt>
<dd>
<div class="desc"><p>This file contains a dictionary of known switches for various CLI tools.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.logging_config" href="logging_config.html">cli_tool_audit.logging_config</a></code></dt>
<dd>
<div class="desc"><p>Logging configuration.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.models" href="models.html">cli_tool_audit.models</a></code></dt>
<dd>
<div class="desc"><p>This module contains dataclasses for the tool audit.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.policy" href="policy.html">cli_tool_audit.policy</a></code></dt>
<dd>
<div class="desc"><p>Apply various policies to the results of the tool checks.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.version_parsing" href="version_parsing.html">cli_tool_audit.version_parsing</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.view_npm_stress_test" href="view_npm_stress_test.html">cli_tool_audit.view_npm_stress_test</a></code></dt>
<dd>
<div class="desc"><p>This module contains a stress test for the cli_tool_audit module …</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.view_pipx_stress_test" href="view_pipx_stress_test.html">cli_tool_audit.view_pipx_stress_test</a></code></dt>
<dd>
<div class="desc"><p>Stress test for the cli_tool_audit package using pipx installed tools as source data.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.view_venv_stress_test" href="view_venv_stress_test.html">cli_tool_audit.view_venv_stress_test</a></code></dt>
<dd>
<div class="desc"><p>Stress test for the cli_tool_audit package using venv as source data.</p></div>
</dd>
<dt><code class="name"><a title="cli_tool_audit.views" href="views.html">cli_tool_audit.views</a></code></dt>
<dd>
<div class="desc"><p>Main output view for cli_tool_audit assuming tool list is in config.</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="cli_tool_audit.check_tool_availability"><code class="name flex">
<span>def <span class="ident">check_tool_availability</span></span>(<span>tool_name: str, schema: <a title="cli_tool_audit.models.SchemaType" href="models.html#cli_tool_audit.models.SchemaType">SchemaType</a>, version_switch: str = '--version') ‑> <a title="cli_tool_audit.models.ToolAvailabilityResult" href="models.html#cli_tool_audit.models.ToolAvailabilityResult">ToolAvailabilityResult</a></span>
</code></dt>
<dd>
<div class="desc"><p>Check if a tool is available in the system's PATH and if possible, determine a version number.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>tool_name</code></strong> :&ensp;<code>str</code></dt>
<dd>The name of the tool to check.</dd>
<dt><strong><code>schema</code></strong> :&ensp;<code><a title="cli_tool_audit.models.SchemaType" href="models.html#cli_tool_audit.models.SchemaType">SchemaType</a></code></dt>
<dd>The schema to use for the version.</dd>
<dt><strong><code>version_switch</code></strong> :&ensp;<code>str</code></dt>
<dd>The switch to get the tool version. Defaults to '&ndash;version'.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code><a title="cli_tool_audit.models.ToolAvailabilityResult" href="models.html#cli_tool_audit.models.ToolAvailabilityResult">ToolAvailabilityResult</a></code></dt>
<dd>An object containing the availability and version of the tool.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def check_tool_availability(
    tool_name: str,
    schema: models.SchemaType,
    version_switch: str = &#34;--version&#34;,
) -&gt; models.ToolAvailabilityResult:
    &#34;&#34;&#34;
    Check if a tool is available in the system&#39;s PATH and if possible, determine a version number.

    Args:
        tool_name (str): The name of the tool to check.
        schema (models.SchemaType): The schema to use for the version.
        version_switch (str): The switch to get the tool version. Defaults to &#39;--version&#39;.


    Returns:
        models.ToolAvailabilityResult: An object containing the availability and version of the tool.
    &#34;&#34;&#34;
    # Check if the tool is in the system&#39;s PATH
    is_broken = True

    last_modified = get_command_last_modified_date(tool_name)
    if not last_modified:
        logger.warning(f&#34;{tool_name} is not on path.&#34;)
        return models.ToolAvailabilityResult(False, True, None, last_modified)
    if schema == models.SchemaType.EXISTENCE:
        logger.debug(f&#34;{tool_name} exists, but not checking for version.&#34;)
        return models.ToolAvailabilityResult(True, False, None, last_modified)

    if version_switch is None or version_switch == &#34;--version&#34;:
        # override default.
        # Could be a problem if KNOWN_SWITCHES was ever wrong.
        version_switch = KNOWN_SWITCHES.get(tool_name, &#34;--version&#34;)

    version = None

    # pylint: disable=broad-exception-caught
    try:
        command = [tool_name, version_switch]
        timeout = int(os.environ.get(&#34;CLI_TOOL_AUDIT_TIMEOUT&#34;, 15))
        result = subprocess.run(
            command, capture_output=True, text=True, timeout=timeout, shell=False, check=True
        )  # nosec
        # Sometimes version is on line 2 or later.
        version = result.stdout.strip()
        if not version:
            # check stderror
            logger.debug(&#34;Got nothing from stdout, checking stderror&#34;)
            version = result.stderr.strip()

        logger.debug(f&#34;Called tool with {&#39; &#39;.join(command)}, got  {version}&#34;)
        is_broken = False
    except subprocess.CalledProcessError as exception:
        is_broken = True
        logger.error(f&#34;{tool_name} failed invocation with {exception}&#34;)
        logger.error(f&#34;{tool_name} stderr: {exception.stderr}&#34;)
        logger.error(f&#34;{tool_name} stdout: {exception.stdout}&#34;)
    except FileNotFoundError:
        logger.error(f&#34;{tool_name} is not on path.&#34;)
        return models.ToolAvailabilityResult(False, True, None, last_modified)

    return models.ToolAvailabilityResult(True, is_broken, version, last_modified)</code></pre>
</details>
</dd>
<dt id="cli_tool_audit.process_tools"><code class="name flex">
<span>def <span class="ident">process_tools</span></span>(<span>cli_tools: dict[str, <a title="cli_tool_audit.models.CliToolConfig" href="models.html#cli_tool_audit.models.CliToolConfig">CliToolConfig</a>], no_cache: bool = False, tags: Optional[list[str]] = None, disable_progress_bar: bool = False) ‑> list[<a title="cli_tool_audit.models.ToolCheckResult" href="models.html#cli_tool_audit.models.ToolCheckResult">ToolCheckResult</a>]</span>
</code></dt>
<dd>
<div class="desc"><p>Process the tools from a dictionary of CliToolConfig objects.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>cli_tools</code></strong> :&ensp;<code>dict[str, <a title="cli_tool_audit.models.CliToolConfig" href="models.html#cli_tool_audit.models.CliToolConfig">CliToolConfig</a>]</code></dt>
<dd>A dictionary of tool names and CliToolConfig objects.</dd>
<dt><strong><code>no_cache</code></strong> :&ensp;<code>bool</code>, optional</dt>
<dd>If True, don't use the cache. Defaults to False.</dd>
<dt><strong><code>tags</code></strong> :&ensp;<code>Optional[list[str]]</code>, optional</dt>
<dd>Only check tools with these tags. Defaults to None.</dd>
<dt><strong><code>disable_progress_bar</code></strong> :&ensp;<code>bool</code>, optional</dt>
<dd>If True, disable the progress bar. Defaults to False.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>list[<a title="cli_tool_audit.models.ToolCheckResult" href="models.html#cli_tool_audit.models.ToolCheckResult">ToolCheckResult</a>]</code></dt>
<dd>A list of ToolCheckResult objects.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def process_tools(
    cli_tools: dict[str, models.CliToolConfig],
    no_cache: bool = False,
    tags: Optional[list[str]] = None,
    disable_progress_bar: bool = False,
) -&gt; list[models.ToolCheckResult]:
    &#34;&#34;&#34;
    Process the tools from a dictionary of CliToolConfig objects.

    Args:
        cli_tools (dict[str, models.CliToolConfig]): A dictionary of tool names and CliToolConfig objects.
        no_cache (bool, optional): If True, don&#39;t use the cache. Defaults to False.
        tags (Optional[list[str]], optional): Only check tools with these tags. Defaults to None.
        disable_progress_bar (bool, optional): If True, disable the progress bar. Defaults to False.

    Returns:
        list[models.ToolCheckResult]: A list of ToolCheckResult objects.
    &#34;&#34;&#34;
    if tags:
        print(tags)
        cli_tools = {
            tool: config
            for tool, config in cli_tools.items()
            if config.tags and any(tag in config.tags for tag in tags)
        }

    # Determine the number of available CPUs
    num_cpus = os.cpu_count()

    enable_cache = len(cli_tools) &gt;= 5
    # Create a ThreadPoolExecutor with one thread per CPU

    if no_cache:
        enable_cache = False
    lock = Lock()
    # Threaded appears faster.
    # lock = Dummy()
    # with ProcessPoolExecutor(max_workers=num_cpus) as executor:
    with ThreadPoolExecutor(max_workers=num_cpus) as executor:
        disable = should_show_progress_bar(cli_tools)
        with tqdm(total=len(cli_tools), disable=disable) as pbar:
            # Submit tasks to the executor
            futures = [
                executor.submit(call_and_compatible.check_tool_wrapper, (tool, config, lock, enable_cache))
                for tool, config in cli_tools.items()
            ]
            results = []
            for future in concurrent.futures.as_completed(futures):
                result = future.result()
                pbar.update(1)
                results.append(result)
    return results</code></pre>
</details>
</dd>
<dt id="cli_tool_audit.read_config"><code class="name flex">
<span>def <span class="ident">read_config</span></span>(<span>file_path: pathlib.Path) ‑> dict[str, <a title="cli_tool_audit.models.CliToolConfig" href="models.html#cli_tool_audit.models.CliToolConfig">CliToolConfig</a>]</span>
</code></dt>
<dd>
<div class="desc"><p>Read the cli-tools section from a pyproject.toml file.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>file_path</code></strong> :&ensp;<code>Path</code></dt>
<dd>The path to the pyproject.toml file.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>dict[str, <a title="cli_tool_audit.models.CliToolConfig" href="models.html#cli_tool_audit.models.CliToolConfig">CliToolConfig</a>]</code></dt>
<dd>A dictionary with the cli-tools section.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def read_config(file_path: Path) -&gt; dict[str, models.CliToolConfig]:
    &#34;&#34;&#34;
    Read the cli-tools section from a pyproject.toml file.

    Args:
        file_path (Path): The path to the pyproject.toml file.

    Returns:
        dict[str, models.CliToolConfig]: A dictionary with the cli-tools section.
    &#34;&#34;&#34;
    # pylint: disable=broad-exception-caught
    try:
        logger.debug(f&#34;Loading config from {file_path}&#34;)
        manager = config_manager.ConfigManager(file_path)
        found = manager.read_config()
        if not found:
            logger.warning(&#34;Config section not found, expected [tool.cli-tools] with values&#34;)
        return manager.tools
    except BaseException as e:
        logger.error(e)
        print(f&#34;Error reading pyproject.toml: {e}&#34;)
        return {}</code></pre>
</details>
</dd>
<dt id="cli_tool_audit.validate"><code class="name flex">
<span>def <span class="ident">validate</span></span>(<span>file_path: pathlib.Path = WindowsPath('pyproject.toml'), no_cache: bool = False, tags: Optional[list[str]] = None, disable_progress_bar: bool = False) ‑> list[<a title="cli_tool_audit.models.ToolCheckResult" href="models.html#cli_tool_audit.models.ToolCheckResult">ToolCheckResult</a>]</span>
</code></dt>
<dd>
<div class="desc"><p>Validate the tools in the pyproject.toml file.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>file_path</code></strong> :&ensp;<code>Path</code>, optional</dt>
<dd>The path to the pyproject.toml file. Defaults to "pyproject.toml".</dd>
<dt><strong><code>no_cache</code></strong> :&ensp;<code>bool</code>, optional</dt>
<dd>If True, don't use the cache. Defaults to False.</dd>
<dt><strong><code>tags</code></strong> :&ensp;<code>Optional[list[str]]</code>, optional</dt>
<dd>Only check tools with these tags. Defaults to None.</dd>
<dt><strong><code>disable_progress_bar</code></strong> :&ensp;<code>bool</code>, optional</dt>
<dd>If True, disable the progress bar. Defaults to False.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>list[<a title="cli_tool_audit.models.ToolCheckResult" href="models.html#cli_tool_audit.models.ToolCheckResult">ToolCheckResult</a>]</code></dt>
<dd>A list of ToolCheckResult objects.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def validate(
    file_path: Path = Path(&#34;pyproject.toml&#34;),
    no_cache: bool = False,
    tags: Optional[list[str]] = None,
    disable_progress_bar: bool = False,
) -&gt; list[models.ToolCheckResult]:
    &#34;&#34;&#34;
    Validate the tools in the pyproject.toml file.

    Args:
        file_path (Path, optional): The path to the pyproject.toml file. Defaults to &#34;pyproject.toml&#34;.
        no_cache (bool, optional): If True, don&#39;t use the cache. Defaults to False.
        tags (Optional[list[str]], optional): Only check tools with these tags. Defaults to None.
        disable_progress_bar (bool, optional): If True, disable the progress bar. Defaults to False.

    Returns:
        list[models.ToolCheckResult]: A list of ToolCheckResult objects.
    &#34;&#34;&#34;
    if tags is None:
        tags = []
    cli_tools = config_reader.read_config(file_path)
    return process_tools(cli_tools, no_cache, tags, disable_progress_bar=disable_progress_bar)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#cli_tool_audit">cli_tool_audit</a><ul>
<li><a href="#how-it-works">How it works</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#demos">Demos</a></li>
<li><a href="#how-does-this-relate-to-package-managers-eg-apt-pipx-npm-choco-etc">How does this relate to package managers, e.g. apt, pipx, npm, choco, etc.</a></li>
<li><a href="#prior-art">Prior Art</a></li>
</ul>
</li>
<li><a href="#use-cases">Use Cases</a><ul>
<li><a href="#developer-environment">Developer Environment</a><ul>
<li><a href="#steps">Steps</a></li>
</ul>
</li>
<li><a href="#serverbuild-server-configuration-drift-detection">Server/Build Server Configuration Drift Detection</a></li>
<li><a href="#end-user-application-pre-flight-checks">End-User Application "pre-flight" checks</a></li>
<li><a href="#steps_1">Steps</a></li>
</ul>
</li>
<li><a href="#environment-variables">Environment Variables</a><ul>
<li><a href="#no_color">NO_COLOR</a></li>
<li><a href="#ci">CI</a></li>
<li><a href="#cli_tool_audit_timeout">CLI_TOOL_AUDIT_TIMEOUT</a></li>
</ul>
</li>
<li><a href="#changelog">Changelog</a><ul>
<li><a href="#300-2024-01-19">[3.0.0] - 2024-01-19</a><ul>
<li><a href="#fixed">Fixed</a></li>
<li><a href="#added">Added</a></li>
</ul>
</li>
<li><a href="#200-2024-01-19">[2.0.0] - 2024-01-19</a><ul>
<li><a href="#fixed_1">Fixed</a></li>
<li><a href="#changed">Changed</a></li>
</ul>
</li>
<li><a href="#120-2024-01-17">[1.2.0] - 2024-01-17</a><ul>
<li><a href="#added_1">Added</a></li>
<li><a href="#fixed_2">Fixed</a></li>
</ul>
</li>
<li><a href="#110-2024-01-16">[1.1.0] - 2024-01-16</a><ul>
<li><a href="#added_2">Added</a></li>
<li><a href="#fixed_3">Fixed</a></li>
</ul>
</li>
<li><a href="#107-2024-01-16">[1.0.7] - 2024-01-16</a><ul>
<li><a href="#fixed_4">Fixed</a></li>
</ul>
</li>
<li><a href="#106-2024-01-15">[1.0.6] - 2024-01-15</a><ul>
<li><a href="#fixed_5">Fixed</a></li>
</ul>
</li>
<li><a href="#105-2024-01-15">[1.0.5] - 2024-01-15</a><ul>
<li><a href="#fixed_6">Fixed</a></li>
</ul>
</li>
<li><a href="#104-2024-01-14">[1.0.4] - 2024-01-14</a><ul>
<li><a href="#added_3">Added</a></li>
<li><a href="#fixed_7">Fixed</a></li>
</ul>
</li>
<li><a href="#103-2024-01-14">[1.0.3] - 2024-01-14</a><ul>
<li><a href="#added_4">Added</a></li>
</ul>
</li>
<li><a href="#102-2024-01-14">[1.0.2] - 2024-01-14</a><ul>
<li><a href="#added_5">Added</a></li>
<li><a href="#fixed_8">Fixed</a></li>
</ul>
</li>
<li><a href="#101-2024-01-13">[1.0.1] - 2024-01-13</a><ul>
<li><a href="#added_6">Added</a></li>
<li><a href="#fixed_9">Fixed</a></li>
</ul>
</li>
<li><a href="#100-2024-01-13">[1.0.0] - 2024-01-13</a><ul>
<li><a href="#added_7">Added</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="cli_tool_audit.audit_cache" href="audit_cache.html">cli_tool_audit.audit_cache</a></code></li>
<li><code><a title="cli_tool_audit.audit_manager" href="audit_manager.html">cli_tool_audit.audit_manager</a></code></li>
<li><code><a title="cli_tool_audit.call_and_compatible" href="call_and_compatible.html">cli_tool_audit.call_and_compatible</a></code></li>
<li><code><a title="cli_tool_audit.call_tools" href="call_tools.html">cli_tool_audit.call_tools</a></code></li>
<li><code><a title="cli_tool_audit.compatibility" href="compatibility.html">cli_tool_audit.compatibility</a></code></li>
<li><code><a title="cli_tool_audit.compatibility_complex" href="compatibility_complex.html">cli_tool_audit.compatibility_complex</a></code></li>
<li><code><a title="cli_tool_audit.config_manager" href="config_manager.html">cli_tool_audit.config_manager</a></code></li>
<li><code><a title="cli_tool_audit.config_reader" href="config_reader.html">cli_tool_audit.config_reader</a></code></li>
<li><code><a title="cli_tool_audit.freeze" href="freeze.html">cli_tool_audit.freeze</a></code></li>
<li><code><a title="cli_tool_audit.interactive" href="interactive.html">cli_tool_audit.interactive</a></code></li>
<li><code><a title="cli_tool_audit.json_utils" href="json_utils.html">cli_tool_audit.json_utils</a></code></li>
<li><code><a title="cli_tool_audit.known_switches" href="known_switches.html">cli_tool_audit.known_switches</a></code></li>
<li><code><a title="cli_tool_audit.logging_config" href="logging_config.html">cli_tool_audit.logging_config</a></code></li>
<li><code><a title="cli_tool_audit.models" href="models.html">cli_tool_audit.models</a></code></li>
<li><code><a title="cli_tool_audit.policy" href="policy.html">cli_tool_audit.policy</a></code></li>
<li><code><a title="cli_tool_audit.version_parsing" href="version_parsing.html">cli_tool_audit.version_parsing</a></code></li>
<li><code><a title="cli_tool_audit.view_npm_stress_test" href="view_npm_stress_test.html">cli_tool_audit.view_npm_stress_test</a></code></li>
<li><code><a title="cli_tool_audit.view_pipx_stress_test" href="view_pipx_stress_test.html">cli_tool_audit.view_pipx_stress_test</a></code></li>
<li><code><a title="cli_tool_audit.view_venv_stress_test" href="view_venv_stress_test.html">cli_tool_audit.view_venv_stress_test</a></code></li>
<li><code><a title="cli_tool_audit.views" href="views.html">cli_tool_audit.views</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="cli_tool_audit.check_tool_availability" href="#cli_tool_audit.check_tool_availability">check_tool_availability</a></code></li>
<li><code><a title="cli_tool_audit.process_tools" href="#cli_tool_audit.process_tools">process_tools</a></code></li>
<li><code><a title="cli_tool_audit.read_config" href="#cli_tool_audit.read_config">read_config</a></code></li>
<li><code><a title="cli_tool_audit.validate" href="#cli_tool_audit.validate">validate</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>